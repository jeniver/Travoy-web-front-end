version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo Installing dependencies...
      - npm ci --legacy-peer-deps
      - echo Dependencies installed successfully

  pre_build:
    commands:
      - echo Starting pre-build phase...
      - echo Node version: $(node --version)
      - echo NPM version: $(npm --version)
      - echo Current directory: $(pwd)
      - echo Listing project files:
      - "ls -la"

  build:
    commands:
      - echo Building the React app with Vite...
      - npm run build
      - echo Build completed successfully
      - echo Build output contents:
      - "ls -la dist/"
      - echo Build artifacts size:
      - "du -sh dist/"

  post_build:
    commands:
      - echo Post-build phase...
      - echo Verifying build output...
      - |
        if [ -f dist/index.html ]; then
          echo "index.html found"
        else
          echo "ERROR: index.html not found"
        fi
      - |
        if [ -d dist/assets ]; then
          echo "assets directory found"
        else
          echo "ERROR: assets directory not found"
        fi
      - echo Build verification completed

artifacts:
  files:
    - '**/*'
  base-directory: dist
  discard-paths: no
  name: travoy-web-build-$(date +%Y-%m-%d-%H-%M-%S)

cache:
  paths:
    - 'node_modules/**/*'
    - '.npm/**/*'
